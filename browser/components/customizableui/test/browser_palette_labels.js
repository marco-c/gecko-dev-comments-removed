


"use strict";
















add_setup(async function () {
  await SpecialPowers.pushPrefEnv({
    set: [["browser.search.widget.new", true]],
  });
});

add_task(async function test_all_buttons_have_labels() {
  let win = await BrowserTestUtils.openNewBrowserWindow();
  registerCleanupFunction(async () => {
    await endCustomizing(win);
    return BrowserTestUtils.closeWindow(win);
  });
  await startCustomizing(win);
  let { palette } = win.gNavToolbox;

  for (let wrapper of palette.children) {
    if (wrapper.hasAttribute("title")) {
      ok(true, wrapper.firstElementChild.id + " has a label.");
    } else {
      info(
        `${wrapper.firstElementChild.id} doesn't seem to have a label, waiting.`
      );
      await BrowserTestUtils.waitForAttribute("title", wrapper);
      ok(
        wrapper.hasAttribute("title"),
        wrapper.firstElementChild.id + " has a label."
      );
    }
    let icons = Array.from(wrapper.querySelectorAll(".toolbarbutton-icon"));
    
    
    if (icons.length) {
      let isIconVisible = icon => {
        let rect = icon.getBoundingClientRect();
        return rect.height > 0 && rect.width > 0;
      };

      
      
      await TestUtils.waitForCondition(
        () => icons.some(isIconVisible),
        `Wait for icons to paint for ${wrapper.firstElementChild.id}`
      );

      Assert.greater(
        icons.filter(isIconVisible).length,
        0,
        `${wrapper.firstElementChild.id} should have at least one visible icon.`
      );
    }
  }
});
