


const HandlerService = Cc[
  "@mozilla.org/uriloader/handler-service;1"
].getService(Ci.nsIHandlerService);

const MIMEService = Cc["@mozilla.org/mime;1"].getService(Ci.nsIMIMEService);


add_task(async function applicationXmlHandleInternally() {
  const mimeInfo = MIMEService.getFromTypeAndExtension(
    "application/xml",
    "xml"
  );
  HandlerService.store(mimeInfo);
  registerCleanupFunction(() => {
    HandlerService.remove(mimeInfo);
  });

  await openPreferencesViaOpenPreferencesAPI("general", { leaveOpen: true });

  let win = gBrowser.selectedBrowser.contentWindow;

  let container = win.document.getElementById("handlersView");

  
  let xmlItem = container.querySelector("moz-box-item[type='application/xml']");
  Assert.ok(xmlItem, "application/xml is present in handlersView");
  if (xmlItem) {
    xmlItem.scrollIntoView({ block: "center" });
    let list = xmlItem.closest("moz-box-group");

    let handleInternallyItem = list.querySelector(
      `moz-option[action='${Ci.nsIHandlerInfo.handleInternally}']`
    );

    ok(!!handleInternallyItem, "handle internally is present");
  }

  gBrowser.removeCurrentTab();
});
