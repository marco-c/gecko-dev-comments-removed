





add_task(async function pdfIsAlwaysPresent() {
  
  for (let test of ["enabled", "disabled"]) {
    await SpecialPowers.pushPrefEnv({
      set: [["pdfjs.disabled", test == "disabled"]],
    });

    await openPreferencesViaOpenPreferencesAPI("general", { leaveOpen: true });

    let win = gBrowser.selectedBrowser.contentWindow;

    let container = win.document.getElementById("handlersView");

    
    let pdfItem = container.querySelector(
      "moz-box-item[type='application/pdf']"
    );
    Assert.ok(pdfItem, "pdfItem is present in handlersView when " + test);
    if (pdfItem) {
      pdfItem.scrollIntoView({ block: "center" });

      
      let list = pdfItem.querySelector(".actionsMenu");
      EventUtils.synthesizeMouseAtCenter(list, {}, win);

      let handleInternallyItem = list.querySelector(
        `moz-option[action='${Ci.nsIHandlerInfo.handleInternally}']`
      );

      is(
        test == "enabled",
        !!handleInternallyItem,
        "handle internally is present when " + test
      );
    }

    gBrowser.removeCurrentTab();
  }
});
