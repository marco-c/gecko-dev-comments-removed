





#ifndef js_loader_ScriptFecthOptions_h
#define js_loader_ScriptFecthOptions_h

#include "mozilla/AlreadyAddRefed.h"
#include "mozilla/CORSMode.h"
#include "mozilla/MemoryReporting.h"
#include "mozilla/dom/ReferrerPolicyBinding.h"
#include "mozilla/dom/RequestBinding.h"  
#include "nsCOMPtr.h"
#include "nsIPrincipal.h"

namespace JS::loader {




enum class ParserMetadata : uint8_t {
  NotParserInserted,
  ParserInserted,
};






















class ScriptFetchOptions {
  ~ScriptFetchOptions();

 public:
  NS_INLINE_DECL_CYCLE_COLLECTING_NATIVE_REFCOUNTING(ScriptFetchOptions)
  NS_DECL_CYCLE_COLLECTION_NATIVE_CLASS(ScriptFetchOptions)

  ScriptFetchOptions(mozilla::CORSMode aCORSMode, const nsAString& aNonce,
                     mozilla::dom::RequestPriority aFetchPriority,
                     const ParserMetadata aParserMetadata,
                     nsIPrincipal* aTriggeringPrincipal = nullptr);

  
  static already_AddRefed<ScriptFetchOptions> CreateDefault();

  void SetTriggeringPrincipal(nsIPrincipal* aTriggeringPrincipal);

  
  
  inline bool IsCompatible(ScriptFetchOptions* other) {
    if (this == other) {
      return true;
    }

    if (mTriggeringPrincipal && other->mTriggeringPrincipal) {
      bool equals;
      (void)mTriggeringPrincipal->Equals(other->mTriggeringPrincipal, &equals);
      if (!equals) {
        return false;
      }
    } else if (mTriggeringPrincipal || other->mTriggeringPrincipal) {
      return false;
    }

    
    return mCORSMode == other->mCORSMode && mNonce == other->mNonce &&
           mFetchPriority == other->mFetchPriority;
  }

  size_t SizeOfIncludingThis(mozilla::MallocSizeOf aMallocSizeOf) const {
    return aMallocSizeOf(this) + SizeOfExcludingThis(aMallocSizeOf);
  }
  size_t SizeOfExcludingThis(mozilla::MallocSizeOf aMallocSizeOf) const {
    return mNonce.SizeOfExcludingThisIfUnshared(aMallocSizeOf);
  }

 public:
  

  




  const mozilla::CORSMode mCORSMode;

  


  const mozilla::dom::RequestPriority mFetchPriority;

  



  const ParserMetadata mParserMetadata;

  




  nsCOMPtr<nsIPrincipal> mTriggeringPrincipal;

  



  const nsString mNonce;
};

}  

#endif  
