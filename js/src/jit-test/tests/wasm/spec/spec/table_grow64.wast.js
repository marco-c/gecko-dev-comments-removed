

















let $0 = instantiate(`(module
  (table \$t64 i64 0 externref)

  (func (export "get-t64") (param \$i i64) (result externref) (table.get \$t64 (local.get \$i)))
  (func (export "set-t64") (param \$i i64) (param \$r externref) (table.set \$t64 (local.get \$i) (local.get \$r)))
  (func (export "grow-t64") (param \$sz i64) (param \$init externref) (result i64)
    (table.grow \$t64 (local.get \$init) (local.get \$sz))
  )
  (func (export "size-t64") (result i64) (table.size \$t64))
)`);


assert_return(() => invoke($0, `size-t64`, []), [value("i64", 0n)]);


assert_trap(() => invoke($0, `set-t64`, [0n, externref(2)]), `out of bounds table access`);


assert_trap(() => invoke($0, `get-t64`, [0n]), `out of bounds table access`);


assert_return(() => invoke($0, `grow-t64`, [1n, null]), [value("i64", 0n)]);


assert_return(() => invoke($0, `size-t64`, []), [value("i64", 1n)]);


assert_return(() => invoke($0, `get-t64`, [0n]), [value('externref', null)]);


assert_return(() => invoke($0, `set-t64`, [0n, externref(2)]), []);


assert_return(() => invoke($0, `get-t64`, [0n]), [new ExternRefResult(2)]);


assert_trap(() => invoke($0, `set-t64`, [1n, externref(2)]), `out of bounds table access`);


assert_trap(() => invoke($0, `get-t64`, [1n]), `out of bounds table access`);


assert_return(() => invoke($0, `grow-t64`, [4n, externref(3)]), [value("i64", 1n)]);


assert_return(() => invoke($0, `size-t64`, []), [value("i64", 5n)]);


assert_return(() => invoke($0, `get-t64`, [0n]), [new ExternRefResult(2)]);


assert_return(() => invoke($0, `set-t64`, [0n, externref(2)]), []);


assert_return(() => invoke($0, `get-t64`, [0n]), [new ExternRefResult(2)]);


assert_return(() => invoke($0, `get-t64`, [1n]), [new ExternRefResult(3)]);


assert_return(() => invoke($0, `get-t64`, [4n]), [new ExternRefResult(3)]);


assert_return(() => invoke($0, `set-t64`, [4n, externref(4)]), []);


assert_return(() => invoke($0, `get-t64`, [4n]), [new ExternRefResult(4)]);


assert_trap(() => invoke($0, `set-t64`, [5n, externref(2)]), `out of bounds table access`);


assert_trap(() => invoke($0, `get-t64`, [5n]), `out of bounds table access`);
