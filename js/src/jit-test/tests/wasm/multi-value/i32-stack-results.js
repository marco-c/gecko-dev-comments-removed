

let {ion, baseline} = wasmEvalText(`(module
    (type $a (array i32))
    (func $ion (export "ion") (result i32 i32)
        i32.const 0
        i32.const 0
    )
    (func $baseline (export "baseline")
        ;; empty array
        (array.new_default $a i32.const 0)

        call $ion
        ;; drop the top of the stack, which is generally in a register
        drop

        ;; index into the array with the stack result
        array.get $a
        drop
    )
)`).exports;


ion();


if (wasmLazyTieringEnabled() && wasmCompileMode() == "baseline+ion") {
    assertEq(wasmFunctionTier(baseline), "baseline");
    assertEq(wasmFunctionTier(ion), "optimized");
}

assertErrorMessage(baseline, WebAssembly.RuntimeError, /index out of bounds/);
