gczeal(0);
gc();


var weakTargets = [];
var weakRefs = [];
var wm = new WeakMap();

for (var i = 0; i < 50; i++) {
  var t = {id: i, data: new Array(20).fill(i)};
  weakTargets.push(t);
  weakRefs.push(new WeakRef(t));
  wm.set(t, {value: i * 2});
}




enqueueMark('enter-weak-marking-mode');
for (var i = 0; i < weakTargets.length; i++) {
  enqueueMark(weakTargets[i]);
}
enqueueMark('abort-weak-marking-mode');


for (var i = 0; i < 25; i++) {
  weakTargets[i] = null;
}


startgc(1);
gcslice(1);
gcslice(1);
gcslice(1);
gcslice(1);
finishgc();


for (var i = 0; i < weakRefs.length; i++) {
  var d = weakRefs[i].deref();
  if (d) {
    d.id;
    wm.get(d);
  }
}
