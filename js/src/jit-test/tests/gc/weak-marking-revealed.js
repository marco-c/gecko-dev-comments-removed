


gczeal(0);

function big_graph() {
  const root = {};
  let obj = root;
  for (let i = 0; i < 100000; i++) {
    obj = obj.o = {};
  }
  return root;
}








var wm1 = new WeakMap();
var wm2 = new WeakMap();
var keys = [{}, {}];
var mid1 = {};
var mid2 = {};
var big1 = big_graph();
var big2 = big_graph();
gc();

wm1.set(keys[0], mid1);
var big = big_graph();
wm2.set(mid1, big1);
wm2.set(keys[1], mid2);
wm1.set(mid2, big2);
addMarkObservers([ big1, big2, mid1, mid2 ]);
big1 = big2 = null;
mid1 = mid2 = null;
gc();
var marks = JSON.stringify(getMarks());
print("Marks: " + marks);
assertEq(marks, '["black","black","black","black"]');
