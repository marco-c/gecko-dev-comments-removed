


let G1 = newGlobal({newCompartment: true});
let G2 = newGlobal({newCompartment: true});
G2.G1 = G1;
G1.G2 = G2;




G1.evaluate(`
  function A() { return G2.B(); }
  function C() { return G2.D(); }
`);
G2.evaluate(`
  function B() { return G1.C(); }
  function D() { debugger; return 5; }
`);

let dbg1 = new Debugger(G1);  
let dbg2 = new Debugger(G2);  

let callCount = 0;
dbg2.onDebuggerStatement = function (frame) {
  callCount++;
  if (callCount === 1) {
    
    
    
    
    
    
    assertEq(frame.callee.name, "D");
    var frameB = frame.older;
    assertEq(frameB.callee.name, "B");
    assertEq(frameB.older, null);
    frameB.eval("debugger;");
    return;
  }
  
  
  
  
  
  
  
  
  
  
  assertEq(callCount, 2);
  var frameA = dbg1.getNewestFrame();
  assertEq(frameA.callee.name, "A");
  assertEq(frameA.older, null);
};
assertEq(G1.A(), 5);
assertEq(callCount, 2);
