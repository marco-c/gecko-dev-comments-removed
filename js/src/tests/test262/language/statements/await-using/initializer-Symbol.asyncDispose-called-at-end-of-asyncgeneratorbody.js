



































































asyncTest(async function () {

  var resource = {
      disposed: false,
      async [Symbol.asyncDispose]() {
          this.disposed = true;
      }
  };

  var releaseF;
  var suspendFPromise = new Promise(function (resolve) { releaseF = resolve; });

  async function * f() {
      await using _ = resource;
      yield;
      await suspendFPromise;
  }

  var g = f();

  var wasDisposedBeforeAsyncGeneratorStarted = resource.disposed;

  await g.next();

  var wasDisposedWhileSuspendedForYield = resource.disposed;

  var nextPromise = g.next();

  var wasDisposedWhileSuspendedForAwait = resource.disposed;

  releaseF();
  await nextPromise;

  var isDisposedAfterCompleted = resource.disposed;

  assert.sameValue(wasDisposedBeforeAsyncGeneratorStarted, false, 'Expected resource to not have been disposed prior to async generator start');
  assert.sameValue(wasDisposedWhileSuspendedForYield, false, 'Expected resource to not have been disposed while async generator function is suspended for yield');
  assert.sameValue(wasDisposedWhileSuspendedForAwait, false, 'Expected resource to not have been disposed while async generator function is suspended during await');
  assert.sameValue(isDisposedAfterCompleted, true, 'Expected resource to have been disposed after async generator function completed');
});
