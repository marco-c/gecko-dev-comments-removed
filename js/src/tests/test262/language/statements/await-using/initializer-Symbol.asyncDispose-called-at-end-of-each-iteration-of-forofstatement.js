


























































asyncTest(async function () {
  var resource = {
      disposed: false,
      async [Symbol.asyncDispose]() {
          this.disposed = true;
      }
  };

  var wasDisposedBeforeBody = false;
  var wasDisposedBeforeIteration = false;
  var wasDisposedAfterIteration = false;

  function * g() {
    wasDisposedBeforeIteration = resource.disposed;
    yield resource;
    wasDisposedAfterIteration = resource.disposed;
  }

  for (await using _ of g()) {
    wasDisposedBeforeBody = resource.disposed;
  }

  assert.sameValue(wasDisposedBeforeIteration, false, 'Expected resource to not been disposed before the for-of loop has received a value');
  assert.sameValue(wasDisposedBeforeBody, false, 'Expected resource to not been disposed while for-of loop is still iterating');
  assert.sameValue(wasDisposedAfterIteration, true, 'Expected resource to have been disposed after the for-of loop advanced to the next value');
});
