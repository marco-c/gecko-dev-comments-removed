













































































asyncTest(async function () {
  var isRunningInSameMicrotask = true;
  var wasStartedInSameMicrotask = false;
  var didEvaluatePrecedingBlockStatementsInSameMicrotask = false;
  var didEvaluateFollowingBlockStatementsInSameMicrotask = false;
  var wasRunningInSameMicrotask = false;

  async function f() {
    wasStartedInSameMicrotask = isRunningInSameMicrotask;
    {
      didEvaluatePrecedingBlockStatementsInSameMicrotask = isRunningInSameMicrotask;
      await using _ = null;
      didEvaluateFollowingBlockStatementsInSameMicrotask = isRunningInSameMicrotask;
    }
    wasRunningInSameMicrotask = isRunningInSameMicrotask;
  }

  var p = f();
  isRunningInSameMicrotask = false;
  await p;

  assert.sameValue(wasStartedInSameMicrotask, true, 'Expected async function containing `await using` to start in the same microtask');
  assert.sameValue(didEvaluatePrecedingBlockStatementsInSameMicrotask, true, 'Expected block statements preceding `await using` to be evaluated in the same microtask');
  assert.sameValue(didEvaluateFollowingBlockStatementsInSameMicrotask, true, 'Expected block statements following `await using` to be evaluated in the same microtask');
  assert.sameValue(wasRunningInSameMicrotask, false, 'Expected statements following the block containing evaluated `await using` to evaluate in a different microtask');
});
