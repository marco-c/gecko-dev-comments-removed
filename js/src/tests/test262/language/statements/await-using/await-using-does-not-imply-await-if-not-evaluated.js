













































































asyncTest(async function () {
  var BREAK_EARLY = true;
  var isRunningInSameMicrotask = true;
  var wasStartedInSameMicrotask = false;
  var didEvaluatePrecedingBlockStatementsInSameMicrotask = false;
  var wasRunningInSameMicrotask = false;

  async function f() {
    wasStartedInSameMicrotask = isRunningInSameMicrotask;
    outer: {
      didEvaluatePrecedingBlockStatementsInSameMicrotask = isRunningInSameMicrotask;
      if (BREAK_EARLY) break outer;
      await using _ = null;
    }
    wasRunningInSameMicrotask = isRunningInSameMicrotask;
  }

  var p = f();
  isRunningInSameMicrotask = false;
  await p;

  assert.sameValue(wasStartedInSameMicrotask, true, 'Expected async function containing `await using` to start in the same microtask');
  assert.sameValue(didEvaluatePrecedingBlockStatementsInSameMicrotask, true, 'Expected block statements preceding `await using` to be evaluated in the same microtask');
  assert.sameValue(wasRunningInSameMicrotask, true, 'Expected statements following the block containing unevaluated `await using` to evaluate in the same microtask');
});
