



"use strict";









addAccessibleTask(
  `
  <button id="invoker" popovertarget="popover">Open</button>
  <p></p>
  <div id="popover" popover="auto">Popover content</div>
`,
  async function (browser, docAcc) {
    let acc = findAccessibleChildByID(docAcc, "invoker");
    
    let shown = waitForEvent(EVENT_SHOW, "popover");
    await invokeContentTask(browser, [], () => {
      content.document.getElementById("popover").showPopover();
    });
    await shown;
    await testAttributeCachePresence(acc, "details", () => {
      acc.getRelationByType(0);
    });
  },
  {
    topLevel: true,
    iframe: true,
    remoteIframe: true,
    cacheDomains: CacheDomain.None,
  }
);


addAccessibleTask(
  `
  <button id="invoker" popovertarget="popover">Open</button>
  <p></p>
  <div id="popover" popover="manual">Popover content</div>
`,
  async function (browser, docAcc) {
    let acc = findAccessibleChildByID(docAcc, "invoker");
    
    let shown = waitForEvent(EVENT_SHOW, "popover");
    await invokeContentTask(browser, [], () => {
      content.document.getElementById("popover").showPopover();
    });
    await shown;
    await testAttributeCachePresence(acc, "details", () => {
      acc.getRelationByType(0);
    });
  },
  {
    topLevel: true,
    iframe: true,
    remoteIframe: true,
    cacheDomains: CacheDomain.None,
  }
);



addAccessibleTask(
  `
  <button id="invoker" popovertarget="popover">Open</button>
  <p></p>
  <div id="popover" popover="hint"><button>Interactive</button></div>
`,
  async function (browser, docAcc) {
    let acc = findAccessibleChildByID(docAcc, "invoker");
    
    let shown = waitForEvent(EVENT_SHOW, "popover");
    await invokeContentTask(browser, [], () => {
      content.document.getElementById("popover").showPopover();
    });
    await shown;
    await testAttributeCachePresence(acc, "details", () => {
      acc.getRelationByType(0);
    });
  },
  {
    topLevel: true,
    iframe: true,
    remoteIframe: true,
    cacheDomains: CacheDomain.None,
  }
);



addAccessibleTask(
  `
  <button id="invoker" popovertarget="popover">Open</button>
  <p></p>
  <div id="popover" popover="hint">Non-interactive content</div>
`,
  async function (browser, docAcc) {
    let acc = findAccessibleChildByID(docAcc, "invoker");
    
    let shown = waitForEvent(EVENT_SHOW, "popover");
    await invokeContentTask(browser, [], () => {
      content.document.getElementById("popover").showPopover();
    });
    await shown;

    acc.getRelationByType(0);
    let hasAttribute;
    try {
      acc.cache.getStringProperty("details");
      hasAttribute = true;
    } catch (e) {
      hasAttribute = false;
    }
    ok(!hasAttribute, "details key is not cached for DESCRIBED_BY relation");
  },
  {
    topLevel: true,
    iframe: true,
    remoteIframe: true,
    cacheDomains: CacheDomain.None,
  }
);
