const STORE_URL =
    '/connection-allowlist/tentative/resources/key-value-store.py';

const IGNORE_ALLOWLIST = 'ignore-allowlist=true';


async function readValueFromServer(key) {
  const serverUrl = `${STORE_URL}?${IGNORE_ALLOWLIST}&key=${key}`;
  const response = await fetch(serverUrl);
  if (!response.ok)
    throw new Error('An error happened in the server');
  const value = await response.text();

  
  if (value === '')
    return {status: false};

  return {status: true, value: value};
}



async function nextValueFromServer(key) {
  
  key = await key;

  while (true) {
    
    const {status, value} = await readValueFromServer(key);
    if (!status) {
      
      await new Promise(resolve => step_timeout(resolve, 100));
      continue;
    }

    return value;
  }
}
