





#ifndef SECURITY_SANDBOX_SANDBOXTARGET_H_
#define SECURITY_SANDBOX_SANDBOXTARGET_H_

#include <windows.h>

#include <functional>
#include <list>
#include <utility>

#include "mozilla/Assertions.h"

namespace sandbox {
class TargetServices;
}

namespace mozilla {

class SandboxTarget {
 public:
  


  static SandboxTarget* Instance();

  






  void SetTargetServices(sandbox::TargetServices* aTargetServices) {
    MOZ_ASSERT(aTargetServices);
    MOZ_ASSERT(!mTargetServices,
               "Sandbox TargetServices must only be set once.");

    mTargetServices = aTargetServices;
  }

  template <typename CallbackT>
  void RegisterSandboxStartCallback(CallbackT&& aCallback) {
    mStartObservers.push_back(std::forward<CallbackT>(aCallback));
  }

  



  void StartSandbox();

  bool GetComplexLineBreaks(const WCHAR* text, uint32_t length,
                            uint8_t* break_before);

 protected:
  SandboxTarget() : mTargetServices(nullptr) {}

  sandbox::TargetServices* mTargetServices;

 private:
  void NotifyStartObservers();
  std::list<std::function<void()>> mStartObservers;
};

}  

#endif
