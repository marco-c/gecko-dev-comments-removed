








use std::fs;

use anyhow::Result;
use camino::Utf8PathBuf;

use crate::{BindgenLoader, BindgenPaths};
mod kotlin;
pub mod python;
mod ruby;
mod swift;
pub use swift::{generate_swift_bindings, SwiftBindingsOptions};

#[cfg(feature = "bindgen-tests")]
pub use self::{
    kotlin::test as kotlin_test, python::test as python_test, ruby::test as ruby_test,
    swift::test as swift_test,
};

#[cfg(feature = "bindgen-tests")]

#[derive(Clone, Debug)]
pub struct RunScriptOptions {
    pub show_compiler_messages: bool,
}

#[cfg(feature = "bindgen-tests")]
impl Default for RunScriptOptions {
    fn default() -> Self {
        Self {
            show_compiler_messages: true,
        }
    }
}




pub fn generate(options: GenerateOptions) -> Result<()> {
    generate_with_bindgen_paths(options, BindgenPaths::default())
}


pub fn generate_with_bindgen_paths(
    options: GenerateOptions,
    mut paths: BindgenPaths,
) -> Result<()> {
    if let Some(path) = &options.config_override {
        paths.add_config_override_layer(path.clone());
    }

    #[cfg(feature = "cargo-metadata")]
    paths.add_cargo_metadata_layer(options.metadata_no_deps)?;

    fs::create_dir_all(&options.out_dir)?;

    let loader = BindgenLoader::new(paths);
    for language in options.languages.iter() {
        match language {
            TargetLanguage::Swift => {
                swift::generate(&loader, options.clone())?;
            }
            TargetLanguage::Kotlin => {
                kotlin::generate(&loader, options.clone())?;
            }
            TargetLanguage::Python => {
                python::generate(&loader, options.clone())?;
            }
            TargetLanguage::Ruby => {
                ruby::generate(&loader, options.clone())?;
            }
        }
    }
    Ok(())
}

#[derive(Clone, Default)]
pub struct GenerateOptions {
    
    pub languages: Vec<TargetLanguage>,
    
    pub source: Utf8PathBuf,
    
    pub out_dir: Utf8PathBuf,
    
    
    pub config_override: Option<Utf8PathBuf>,
    
    pub format: bool,
    
    pub crate_filter: Option<String>,
    
    
    
    
    
    pub metadata_no_deps: bool,
}

#[derive(Clone, Debug)]
pub enum TargetLanguage {
    Kotlin,
    Python,
    Ruby,
    Swift,
}
