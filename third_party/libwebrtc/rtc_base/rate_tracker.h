









#ifndef RTC_BASE_RATE_TRACKER_H_
#define RTC_BASE_RATE_TRACKER_H_

#include <stdint.h>
#include <stdlib.h>

#include "api/units/time_delta.h"
#include "api/units/timestamp.h"

namespace webrtc {




class RateTracker {
 public:
  RateTracker(int64_t bucket_milliseconds, size_t bucket_count);
  ~RateTracker();

  
  
  
  double ComputeRateForInterval(Timestamp current_time,
                                TimeDelta interval) const;

  
  
  double Rate(Timestamp current_time) const {
    return ComputeRateForInterval(
        current_time, TimeDelta::Millis(bucket_milliseconds_) * bucket_count_);
  }

  
  int64_t TotalSampleCount() const;

  
  void Update(int64_t sample_count, Timestamp now);

 private:
  void EnsureInitialized(int64_t current_time_ms);
  size_t NextBucketIndex(size_t bucket_index) const;

  const int64_t bucket_milliseconds_;
  const size_t bucket_count_;
  int64_t* sample_buckets_;
  size_t total_sample_count_;
  size_t current_bucket_;
  int64_t bucket_start_time_milliseconds_;
  int64_t initialization_time_milliseconds_;
};

}  


#endif  
