









#ifndef VIDEO_TIMING_SIMULATOR_DECODABILITY_TRACKER_H_
#define VIDEO_TIMING_SIMULATOR_DECODABILITY_TRACKER_H_

#include <memory>

#include "absl/base/nullability.h"
#include "api/environment/environment.h"
#include "api/sequence_checker.h"
#include "api/video/encoded_frame.h"
#include "api/video/frame_buffer.h"
#include "rtc_base/thread_annotations.h"
#include "video/timing/simulator/assembler.h"

namespace webrtc::video_timing_simulator {


class DecodabilityTrackerEvents {
 public:
  virtual ~DecodabilityTrackerEvents() = default;
  virtual void OnDecodableFrame(const EncodedFrame& decodable_frame) = 0;
};






class DecodabilityTracker : public AssembledFrameCallback {
 public:
  DecodabilityTracker(const Environment& env,
                      DecodabilityTrackerEvents* absl_nonnull observer);
  ~DecodabilityTracker() override;

  DecodabilityTracker(const DecodabilityTracker&) = delete;
  DecodabilityTracker& operator=(const DecodabilityTracker&) = delete;

  void SetDecodedFrameIdCallback(
      DecodedFrameIdCallback* absl_nonnull decoded_id_cb);

  
  
  
  void OnAssembledFrame(std::unique_ptr<EncodedFrame> assembled_frame) override;

 private:
  
  SequenceChecker sequence_checker_;
  const Environment env_;

  
  FrameBuffer frame_buffer_ RTC_GUARDED_BY(sequence_checker_);

  
  DecodabilityTrackerEvents& observer_;
  DecodedFrameIdCallback* absl_nullable decoded_frame_id_cb_
      RTC_GUARDED_BY(sequence_checker_);
};

}  

#endif  
