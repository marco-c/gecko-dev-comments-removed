





#include "IOSurfacePort.h"

#ifdef XP_DARWIN
#  include <IOSurface/IOSurfaceRef.h>
#  include "CFTypeRefPtr.h"
#endif

namespace mozilla::layers {

#ifdef XP_DARWIN
CFTypeRefPtr<IOSurfaceRef> IOSurfacePort::GetSurface() const {
  
  if (IOSurfaceRef s = IOSurfaceLookupFromMachPort(mPort.get())) {
    return CFTypeRefPtr<IOSurfaceRef>::WrapUnderCreateRule(s);
  }
  return {};
}

IOSurfacePort IOSurfacePort::FromSurface(
    const CFTypeRefPtr<IOSurfaceRef>& aSurface) {
  return {UniqueMachSendRight(IOSurfaceCreateMachPort(aSurface.get()))};
}

bool IOSurfacePort::operator==(const IOSurfacePort& aOther) const {
  return mPort.get() == aOther.mPort.get();
}
#endif

}  
