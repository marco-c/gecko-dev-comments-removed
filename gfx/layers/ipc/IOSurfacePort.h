





#ifndef mozilla_gfx_IOSurfacePort_h_
#define mozilla_gfx_IOSurfacePort_h_

#include "chrome/common/ipc_message_utils.h"

#ifdef XP_DARWIN
#  include "mozilla/UniquePtrExtensions.h"

template <typename T>
class CFTypeRefPtr;
struct __IOSurface;
typedef __IOSurface* IOSurfaceRef;
#endif









namespace mozilla::layers {




struct IOSurfacePort {
#ifdef XP_DARWIN
  UniqueMachSendRight mPort;

  CFTypeRefPtr<IOSurfaceRef> GetSurface() const;
  static IOSurfacePort FromSurface(const CFTypeRefPtr<IOSurfaceRef>& aSurface);

  bool operator==(const IOSurfacePort& aOther) const;
#endif
};

}  

namespace IPC {

template <>
struct ParamTraits<mozilla::layers::IOSurfacePort> {
  using paramType = mozilla::layers::IOSurfacePort;

  static void Write(MessageWriter* writer, paramType&& param) {
#ifdef XP_DARWIN
    WriteParam(writer, std::move(param.mPort));
#endif
  }
  static bool Read(MessageReader* reader, paramType* result) {
#ifdef XP_DARWIN
    return ReadParam(reader, &result->mPort);
#else
    return true;
#endif
  }
};

}  

#endif 
