





#include "mozilla/dom/CSSUnitValue.h"

#include "mozilla/AlreadyAddRefed.h"
#include "mozilla/CSSPropertyId.h"
#include "mozilla/ErrorResult.h"
#include "mozilla/RefPtr.h"
#include "mozilla/ServoStyleConsts.h"
#include "mozilla/dom/BindingDeclarations.h"
#include "mozilla/dom/CSSUnitValueBinding.h"

namespace mozilla::dom {

CSSUnitValue::CSSUnitValue(nsCOMPtr<nsISupports> aParent, double aValue,
                           const nsACString& aUnit)
    : CSSNumericValue(std::move(aParent), NumericValueType::UnitValue),
      mValue(aValue),
      mUnit(aUnit) {}


RefPtr<CSSUnitValue> CSSUnitValue::Create(nsCOMPtr<nsISupports> aParent,
                                          const StyleUnitValue& aUnitValue) {
  return MakeRefPtr<CSSUnitValue>(aParent, aUnitValue.value, aUnitValue.unit);
}

JSObject* CSSUnitValue::WrapObject(JSContext* aCx,
                                   JS::Handle<JSObject*> aGivenProto) {
  return CSSUnitValue_Binding::Wrap(aCx, this, aGivenProto);
}






already_AddRefed<CSSUnitValue> CSSUnitValue::Constructor(
    const GlobalObject& aGlobal, double aValue, const nsACString& aUnit,
    ErrorResult& aRv) {
  
  
  
  

  

  
  

  

  return MakeAndAddRef<CSSUnitValue>(aGlobal.GetAsSupports(), aValue, aUnit);
}

double CSSUnitValue::Value() const { return mValue; }

void CSSUnitValue::SetValue(double aArg) { mValue = aArg; }

void CSSUnitValue::GetUnit(nsCString& aRetVal) const { aRetVal = mUnit; }



void CSSUnitValue::ToCssTextWithProperty(const CSSPropertyId& aPropertyId,
                                         nsACString& aDest) const {
  
  
  
  
  
  
  
  
  
  
  
  
  const bool isValueOutOfRange = [](NonCustomCSSPropertyId aId, double aValue) {
    switch (aId) {
      case eCSSProperty_column_width:
      case eCSSProperty_perspective:
      case eCSSProperty_border_block_end_width:
      case eCSSProperty_border_block_start_width:
      case eCSSProperty_border_bottom_width:
      case eCSSProperty_border_inline_end_width:
      case eCSSProperty_border_inline_start_width:
      case eCSSProperty_border_left_width:
      case eCSSProperty_border_right_width:
      case eCSSProperty_border_top_width:
      case eCSSProperty_outline_width:
        return aValue < 0;

      default:
        return false;
    }
  }(aPropertyId.mId, mValue);

  if (isValueOutOfRange) {
    aDest.Append("calc("_ns);
  }

  aDest.AppendFloat(mValue);

  if (mUnit.Equals("percent"_ns)) {
    aDest.Append("%"_ns);
  } else if (!mUnit.Equals("number"_ns)) {
    aDest.Append(mUnit);
  }

  if (isValueOutOfRange) {
    aDest.Append(")"_ns);
  }
}

StyleUnitValue CSSUnitValue::ToStyleUnitValue() const {
  return StyleUnitValue(mValue, StyleCssString(mUnit));
}

const CSSUnitValue& CSSNumericValue::GetAsCSSUnitValue() const {
  MOZ_DIAGNOSTIC_ASSERT(mNumericValueType == NumericValueType::UnitValue);

  return *static_cast<const CSSUnitValue*>(this);
}

CSSUnitValue& CSSNumericValue::GetAsCSSUnitValue() {
  MOZ_DIAGNOSTIC_ASSERT(mNumericValueType == NumericValueType::UnitValue);

  return *static_cast<CSSUnitValue*>(this);
}

}  
