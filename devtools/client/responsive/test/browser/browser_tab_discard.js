


"use strict";



const TEST_URL = "https://example.com/";

addRDMTask(
  null,
  async function () {
    const tab = await addTab(TEST_URL);

    const { ui } = await openRDM(tab);
    await waitForDeviceAndViewportState(ui);
    const clientClosed = waitForClientClose(ui);

    closeRDM(tab, {
      reason: "TabBrowserDiscarded",
    });

    
    
    
    is(ui.destroyed, true, "RDM closed synchronously");

    await clientClosed;
    await removeTab(tab);
  },
  { onlyPrefAndTask: true }
);

addRDMTask(
  null,
  async function () {
    const tab = await addTab(TEST_URL);

    const { ui } = await openRDM(tab);
    await waitForDeviceAndViewportState(ui);
    const clientClosed = waitForClientClose(ui);

    
    info("Create another tab to deselect the tab to discard");
    const tab2 = await addTab(TEST_URL);

    info("Discard the initial tab");
    gBrowser.discardBrowser(tab);

    
    
    
    is(ui.destroyed, true, "RDM closed synchronously");

    await clientClosed;
    await removeTab(tab);
    await removeTab(tab2);
  },
  { onlyPrefAndTask: true }
);
